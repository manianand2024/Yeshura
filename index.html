<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yeshura | SOC 2 GRC Lab</title>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f8fafc; /* Lighter background like your App.css */
            color: #1e293b;
        }

        /* Styles from your App.css */
        .app-container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 30px;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        h1 {
            color: #004d99;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 15px;
            font-weight: 700;
        }

        .control-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .control-table th, .control-table td {
            border: 1px solid #e2e8f0;
            padding: 12px;
            text-align: left;
            font-size: 0.875rem;
        }

        .control-table th { background-color: #f1f5f9; color: #475569; }

        .btn-primary { background-color: #007bff; color: white; padding: 8px 16px; border-radius: 6px; font-weight: 500; transition: 0.3s; }
        .btn-primary:hover { background-color: #0056b3; transform: translateY(-1px); }
        
        .btn-danger { background-color: #dc3545; color: white; padding: 8px 16px; border-radius: 6px; font-weight: 500; }
        .btn-danger:hover { background-color: #c82333; }

        .gap-yes { color: #dc3545; font-weight: bold; background: #fef2f2; padding: 2px 6px; rounded: 4px; }
        .gap-no { color: #16a34a; font-weight: bold; background: #f0fdf4; padding: 2px 6px; rounded: 4px; }

        .form-overlay {
            background: rgba(15, 23, 42, 0.5);
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- COMPONENT: AddEditControlForm ---
        const AddEditControlForm = ({ controlToEdit, onSave, onCancel }) => {
            const initialControlState = {
                id: '', domain: '', trustServiceCriteria: '', controlID: '',
                controlDescription: '', currentStatus: 'No', evidenceAvailable: false,
                gapIdentified: true, remediationPlan: '', responsibleOwner: '',
                targetDate: '', notes: '',
            };

            const [control, setControl] = useState(initialControlState);

            useEffect(() => {
                if (controlToEdit) {
                    setControl({
                        ...controlToEdit,
                        targetDate: controlToEdit.targetDate ? new Date(controlToEdit.targetDate).toISOString().split('T')[0] : '',
                    });
                } else {
                    setControl(initialControlState);
                }
            }, [controlToEdit]);

            const handleChange = (e) => {
                const { name, value, type, checked } = e.target;
                let newValue = type === 'checkbox' ? checked : value;

                if (name === 'currentStatus' || name === 'evidenceAvailable') {
                    setControl((prev) => {
                        const updated = { ...prev, [name]: newValue };
                        updated.gapIdentified = updated.currentStatus === 'No' || !updated.evidenceAvailable;
                        return updated;
                    });
                } else {
                    setControl((prev) => ({ ...prev, [name]: newValue }));
                }
            };

            return (
                <div className="fixed inset-0 form-overlay flex items-center justify-center p-4 z-50">
                    <div className="bg-white p-8 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                        <h3 className="text-2xl font-bold mb-6 text-slate-800 border-b pb-4">
                            {controlToEdit ? 'Edit Control' : 'Add New Control'}
                        </h3>
                        <form onSubmit={(e) => { e.preventDefault(); onSave(control); }}>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-semibold mb-1">Domain</label>
                                    <input className="w-full border p-2 rounded" type="text" name="domain" value={control.domain} onChange={handleChange} required />
                                </div>
                                <div>
                                    <label className="block text-sm font-semibold mb-1">Control ID</label>
                                    <input className="w-full border p-2 rounded" type="text" name="controlID" value={control.controlID} onChange={handleChange} required />
                                </div>
                                <div className="md:col-span-2">
                                    <label className="block text-sm font-semibold mb-1">Description</label>
                                    <textarea className="w-full border p-2 rounded" name="controlDescription" value={control.controlDescription} onChange={handleChange} rows="3" required />
                                </div>
                                <div>
                                    <label className="block text-sm font-semibold mb-1">Status (Yes/No)</label>
                                    <select className="w-full border p-2 rounded" name="currentStatus" value={control.currentStatus} onChange={handleChange}>
                                        <option value="Yes">Yes</option>
                                        <option value="No">No</option>
                                    </select>
                                </div>
                                <div className="flex items-center gap-2 pt-6">
                                    <input type="checkbox" name="evidenceAvailable" checked={control.evidenceAvailable} onChange={handleChange} />
                                    <label className="text-sm font-semibold">Evidence Available?</label>
                                </div>
                            </div>
                            
                            <div className="mt-8 flex justify-end gap-3 border-t pt-6">
                                <button type="button" onClick={onCancel} className="px-6 py-2 border rounded-lg hover:bg-slate-50">Cancel</button>
                                <button type="submit" className="btn-primary">Save Control</button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        // --- COMPONENT: App (Main Logic) ---
        function App() {
            const initialHardcodedControls = [
                { id: '1', domain: 'Security', trustServiceCriteria: 'Common Criteria', controlID: 'CC1.1', controlDescription: 'The entity demonstrates a commitment to integrity and ethical values.', currentStatus: 'No', evidenceAvailable: false, gapIdentified: true, remediationPlan: '', responsibleOwner: '', targetDate: '', notes: '' },
                { id: '2', domain: 'Security', trustServiceCriteria: 'Common Criteria', controlID: 'CC1.2', controlDescription: 'The board demonstrates independence and exercises oversight.', currentStatus: 'No', evidenceAvailable: false, gapIdentified: true, remediationPlan: '', responsibleOwner: '', targetDate: '', notes: '' }
            ];

            const [controls, setControls] = useState(initialHardcodedControls);
            const [editingControl, setEditingControl] = useState(null);
            const [showForm, setShowForm] = useState(false);

            const handleSaveControl = (controlData) => {
                setControls(prev => {
                    if (controlData.id) {
                        return prev.map(c => c.id === controlData.id ? controlData : c);
                    } else {
                        const newId = (prev.length + 1).toString();
                        return [...prev, { ...controlData, id: newId }];
                    }
                });
                setShowForm(false);
            };

            const handleDelete = (id) => {
                if(confirm("Delete this control?")) {
                    setControls(prev => prev.filter(c => c.id !== id));
                }
            };

            return (
                <div className="app-container">
                    <header className="flex justify-between items-center mb-8 border-b pb-6">
                        <div className="text-left">
                            <h1 className="border-none mb-0 pb-0 text-sky-700">Yeshura SOC 2</h1>
                            <p className="text-slate-500">Governance & Gap Analysis Dashboard</p>
                        </div>
                        <button onClick={() => { setEditingControl(null); setShowForm(true); }} className="btn-primary">
                            + Add New Control
                        </button>
                    </header>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div className="p-4 bg-sky-50 rounded-xl border border-sky-100">
                            <p className="text-xs font-bold text-sky-600 uppercase">Compliance Score</p>
                            <p className="text-2xl font-bold">{Math.round((controls.filter(c => !c.gapIdentified).length / controls.length) * 100)}%</p>
                        </div>
                        <div className="p-4 bg-rose-50 rounded-xl border border-rose-100">
                            <p className="text-xs font-bold text-rose-600 uppercase">Identified Gaps</p>
                            <p className="text-2xl font-bold">{controls.filter(c => c.gapIdentified).length}</p>
                        </div>
                        <div className="p-4 bg-slate-50 rounded-xl border border-slate-100">
                            <p className="text-xs font-bold text-slate-600 uppercase">Total Controls</p>
                            <p className="text-2xl font-bold">{controls.length}</p>
                        </div>
                    </div>

                    <div className="overflow-x-auto">
                        <table className="control-table">
                            <thead>
                                <tr>
                                    <th>Domain</th>
                                    <th>Control ID</th>
                                    <th>Description</th>
                                    <th>Status</th>
                                    <th>Evidence</th>
                                    <th>Gap</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {controls.map(c => (
                                    <tr key={c.id} className="hover:bg-slate-50 transition">
                                        <td>{c.domain}</td>
                                        <td className="font-mono font-bold text-sky-600">{c.controlID}</td>
                                        <td className="max-w-xs truncate">{c.controlDescription}</td>
                                        <td>{c.currentStatus}</td>
                                        <td>{c.evidenceAvailable ? '✅ Yes' : '❌ No'}</td>
                                        <td>
                                            <span className={c.gapIdentified ? 'gap-yes' : 'gap-no'}>
                                                {c.gapIdentified ? 'GAP' : 'PASSED'}
                                            </span>
                                        </td>
                                        <td className="flex gap-2">
                                            <button onClick={() => { setEditingControl(c); setShowForm(true); }} className="text-sky-600 hover:underline">Edit</button>
                                            <button onClick={() => handleDelete(c.id)} className="text-rose-600 hover:underline">Delete</button>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>

                    {showForm && (
                        <AddEditControlForm 
                            controlToEdit={editingControl} 
                            onSave={handleSaveControl} 
                            onCancel={() => setShowForm(false)} 
                        />
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
