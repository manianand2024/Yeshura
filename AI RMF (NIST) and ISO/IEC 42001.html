<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yeshura | NIST AI RMF & ISO 42001 Lab</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #f1f5f9; }
        .dashboard-card { background: rgba(30, 41, 59, 0.7); border: 1px solid #334155; border-radius: 16px; padding: 1.5rem; }
        .row-unsaved { border-left: 4px solid #f59e0b !important; background: rgba(245, 158, 11, 0.05); }
        select, input { background: #1e293b !important; color: white !important; border: 1px solid #475569 !important; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // NIST AI RMF 1.0 & ISO 42001 Mapped Data
      const initialAIControls = [
  // --- NIST AI RMF CORE FUNCTIONS ---
  { id: '1', framework: 'NIST RMF', category: 'GOVERN', code: 'GOVERN 1.1', requirement: 'Legal & Regulatory Compliance', desc: 'Policies ensure AI systems comply with applicable laws and ethical standards.', status: 'No', evidence: false, gap: true },
  { id: '2', framework: 'NIST RMF', category: 'GOVERN', code: 'GOVERN 1.2', requirement: 'Accountability Structures', desc: 'Roles and responsibilities for AI risk management are clearly defined and documented.', status: 'No', evidence: false, gap: true },
  { id: '3', framework: 'NIST RMF', category: 'MAP', code: 'MAP 1.1', requirement: 'Contextual Prioritization', desc: 'Document intended use and potential positive/negative impacts of the AI system.', status: 'No', evidence: false, gap: true },
  { id: '4', framework: 'NIST RMF', category: 'MAP', code: 'MAP 1.5', requirement: 'Scientific Integrity', desc: 'The scientific basis and limitations of the AI model are identified and recorded.', status: 'No', evidence: false, gap: true },
  { id: '5', framework: 'NIST RMF', category: 'MEASURE', code: 'MEASURE 1.1', requirement: 'Trustworthiness Metrics', desc: 'Establish quantitative and qualitative metrics for fairness, safety, and security.', status: 'No', evidence: false, gap: true },
  { id: '6', framework: 'NIST RMF', category: 'MEASURE', code: 'MEASURE 2.1', requirement: 'Independent Evaluation', desc: 'AI systems are regularly assessed by parties not involved in their development.', status: 'No', evidence: false, gap: true },
  { id: '7', framework: 'NIST RMF', category: 'MANAGE', code: 'MANAGE 1.1', requirement: 'Risk Response Execution', desc: 'Identify and prioritize AI risks for action according to risk tolerance.', status: 'No', evidence: false, gap: true },
  { id: '8', framework: 'NIST RMF', category: 'MANAGE', code: 'MANAGE 1.3', requirement: 'Third-Party Risk Management', desc: 'Mitigate risks from third-party AI data, models, or software components.', status: 'No', evidence: false, gap: true },

  // --- ISO/IEC 42001 ANNEX A CONTROLS ---
  { id: '9', framework: 'ISO 42001', category: 'PLAN', code: 'A.5.2', requirement: 'AI System Impact Assessment', desc: 'Assess potential consequences on individuals, society, and ethical boundaries.', status: 'No', evidence: false, gap: true },
  { id: '10', framework: 'ISO 42001', category: 'DATA', code: 'A.7.2', requirement: 'Data Governance for AI', desc: 'Establish processes for data acquisition, labeling, and quality management.', status: 'No', evidence: false, gap: true },
  { id: '11', framework: 'ISO 42001', category: 'DATA', code: 'A.7.4', requirement: 'Data Quality & Bias', desc: 'Define requirements for data representativeness to minimize algorithmic bias.', status: 'No', evidence: false, gap: true },
  { id: '12', framework: 'ISO 42001', category: 'USER', code: 'A.8.2', requirement: 'Transparency & Explainability', desc: 'Provide documentation explaining how AI reaches decisions or specific outputs.', status: 'No', evidence: false, gap: true },
  { id: '13', framework: 'ISO 42001', category: 'LIFE', code: 'A.10.1', requirement: 'AI Life Cycle Management', desc: 'Maintain governance from design through retirement or decommissioning.', status: 'No', evidence: false, gap: true },
  { id: '14', framework: 'ISO 42001', category: 'LIFE', code: 'A.10.2', requirement: 'Supply Chain Accountability', desc: 'Define responsibilities when using external AI models or service providers.', status: 'No', evidence: false, gap: true },
  { id: '15', framework: 'ISO 42001', category: 'MONITOR', code: 'A.10.4', requirement: 'Logging & Monitoring', desc: 'Maintain audit logs of AI performance and decisions for forensic review.', status: 'No', evidence: false, gap: true },
  { id: '16', framework: 'ISO 42001', category: 'MONITOR', code: 'A.10.6', requirement: 'AI Incident Response', desc: 'Procedures for handling AI failures like model drift or adversarial attacks.', status: 'No', evidence: false, gap: true }
];

        const ControlRow = ({ control, onSave }) => {
            const [local, setLocal] = useState({...control});
            const [dirty, setDirty] = useState(false);

            const handleUpdate = (field, val) => {
                setLocal(prev => ({ ...prev, [field]: val }));
                setDirty(true);
            };

            const triggerSave = () => {
                // Gap Logic: Gap if Status is 'No' OR Evidence is missing
                const isGap = local.status === 'No' || !local.evidence;
                onSave({ ...local, gap: isGap });
                setDirty(false);
            };

            return (
                <tr className={`border-b border-slate-800 transition ${dirty ? 'row-unsaved' : 'hover:bg-slate-800/40'}`}>
                    <td className="p-4"><span className="text-[10px] font-bold bg-slate-700 px-2 py-1 rounded">{local.framework}</span></td>
                    <td className="p-4 font-mono text-sky-400 text-sm">{local.code}</td>
                    <td className="p-4">
                        <div className="font-semibold text-white text-sm">{local.requirement}</div>
                        <div className="text-[11px] text-slate-500">{local.desc}</div>
                    </td>
                    <td className="p-4">
                        <select value={local.status} onChange={(e) => handleUpdate('status', e.target.value)} className="text-xs p-1 rounded">
                            <option value="No">Missing</option>
                            <option value="Yes">Implemented</option>
                        </select>
                    </td>
                    <td className="p-4">
                        <input type="checkbox" checked={local.evidence} onChange={(e) => handleUpdate('evidence', e.target.checked)} className="w-4 h-4" />
                        <span className="text-[10px] ml-2 text-slate-400">Attached?</span>
                    </td>
                    <td className="p-4 text-center">
                        <span className={`text-[10px] font-bold px-2 py-1 rounded ${local.gap ? 'bg-rose-500/20 text-rose-400' : 'bg-emerald-500/20 text-emerald-400'}`}>
                            {local.gap ? 'GAP' : 'PASSED'}
                        </span>
                    </td>
                    <td className="p-4">
                        <button onClick={triggerSave} disabled={!dirty} className={`text-[10px] font-bold py-1 px-4 rounded uppercase transition ${dirty ? 'bg-sky-500 hover:bg-sky-400 text-white' : 'bg-slate-800 text-slate-600'}`}>
                            Save Row
                        </button>
                    </td>
                </tr>
            );
        };

        function App() {
            const [controls, setControls] = useState(initialAIControls);

            const handleRowSave = (updated) => {
                setControls(prev => prev.map(c => c.id === updated.id ? updated : c));
            };

            const stats = {
                total: controls.length,
                passed: controls.filter(c => !c.gap).length,
                gaps: controls.filter(c => c.gap).length
            };

            return (
                <div className="max-w-7xl mx-auto p-8">
                    <header className="mb-10 flex justify-between items-center">
                        <div>
                            <h1 className="text-3xl font-black tracking-tight text-white">YESHURA <span className="text-sky-500 italic">AI AUDIT</span></h1>
                            <p className="text-slate-500 text-xs font-bold uppercase tracking-widest mt-1">NIST AI RMF 1.0 & ISO/IEC 42001 Framework</p>
                        </div>
                    </header>

                    {/* Dashboard Metrics */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
                        <div className="dashboard-card border-l-4 border-sky-500">
                            <p className="text-xs font-bold text-slate-500 uppercase">Compliance Readiness</p>
                            <h2 className="text-4xl font-black mt-2">{Math.round((stats.passed / stats.total) * 100)}%</h2>
                        </div>
                        <div className="dashboard-card border-l-4 border-rose-500">
                            <p className="text-xs font-bold text-slate-500 uppercase">Open Gaps</p>
                            <h2 className="text-4xl font-black mt-2 text-rose-500">{stats.gaps}</h2>
                        </div>
                        <div className="dashboard-card border-l-4 border-emerald-500">
                            <p className="text-xs font-bold text-slate-500 uppercase">Verified Controls</p>
                            <h2 className="text-4xl font-black mt-2 text-emerald-400">{stats.passed} / {stats.total}</h2>
                        </div>
                    </div>

                    {/* Integrated Control Table */}
                    <div className="dashboard-card p-0 overflow-hidden">
                        <div className="p-6 border-b border-slate-800 bg-slate-800/30">
                            <h3 className="font-bold text-lg">Control Verification Hub</h3>
                        </div>
                        <table className="w-full text-left border-collapse">
                            <thead className="bg-slate-900/50">
                                <tr>
                                    <th className="p-4 text-[10px] uppercase text-slate-500">Standard</th>
                                    <th className="p-4 text-[10px] uppercase text-slate-500">ID</th>
                                    <th className="p-4 text-[10px] uppercase text-slate-500">Requirement</th>
                                    <th className="p-4 text-[10px] uppercase text-slate-500">Status</th>
                                    <th className="p-4 text-[10px] uppercase text-slate-500">Evidence</th>
                                    <th className="p-4 text-center text-[10px] uppercase text-slate-500">Audit Result</th>
                                    <th className="p-4 text-[10px] uppercase text-slate-500">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {controls.map(c => <ControlRow key={c.id} control={c} onSave={handleRowSave} />)}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
